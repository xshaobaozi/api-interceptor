(()=>{"use strict";const e=window.XMLHttpRequest,t=()=>{const e={};return["apis","openMock"].forEach((t=>{e[t]=(e=>{try{return JSON.parse(e)}catch(t){return e}})(window.sessionStorage.getItem(`api_interceptor__${t}`))})),e};class s{constructor(){this._method="";const t=new e;t._open=t.open;const s=this;for(let e in t)"onreadystatechange"!==e?("open"===e&&(t.open=function(...e){0===e.length||(s._method=e[0],t._open(...e))}),"onload"!==e?"function"!=typeof t[e]?["responseText","response"].includes(e)?Object.defineProperty(this,e,{get:()=>null==this[`_${e}`]?t[e]:this[`_${e}`],set:t=>this[`_${e}`]=t,enumerable:!0}):Object.defineProperty(this,e,{get:()=>t[e],set:s=>t[e]=s,enumerable:!0}):this[e]=t[e].bind(t):t.onload=(...e)=>{this.modifilyResponse(),this.onload&&this.onload.apply(this,e)}):t.onreadystatechange=(...e)=>{4==this.readyState&&this.modifilyResponse(),this.onreadystatechange&&this.onreadystatechange.apply(this,e)}}modifilyResponse(){const{apis:e}=t();if(!e)return void console.warn("apis找不到");let s=!1;e.forEach((e=>{if(!0===e.disabled)return;if(!0===s)return;const{schema:t}=e,{paths:o}=t,n=o.find((e=>{const{methods:t,uri:s,disabled:o}=e;return!o&&this.responseURL.indexOf(s)>-1&&String(this._method).toLocaleLowerCase()===t}));n&&(s=!0,this.responseText=n.response,this.response=n.response)}))}}new s,window.addEventListener("toPage",(o=>{const{apis:n,openMock:i}=t();(t=>{if(t)return console.log("开启"),void(window.XMLHttpRequest=s);console.log("禁用"),window.XMLHttpRequest=e})(i)}))})();